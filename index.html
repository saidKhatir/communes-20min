<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Accessibilité 20 Minutes</title>
    
     <!-- MapLibre GL JS -->
    
     <script src="https://unpkg.com/maplibre-gl@^5.15.0/dist/maplibre-gl.js"></script>
     <link href="https://unpkg.com/maplibre-gl@^5.15.0/dist/maplibre-gl.css" rel="stylesheet" />
    
     <!-- Turf.js -->
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@7/turf.min.js"></script>
    <!-- Styles locaux -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header avec recherche -->
    <header class="header">
        <h1 class="header-title">Communes accessibles en voiture en 30 minutes depuis le lieu de travail, en conditions de trafic fluide.</h1>
        <div class="search-container">
            <input 
                type="text" 
                id="search-input" 
                class="search-input" 
                placeholder="Rechercher une commune..."
                autocomplete="off"
            >
            <div id="search-results" class="search-results hidden"></div>
        </div>
    </header>

    <!-- Carte -->
    <div id="map" class="map-container"></div>

    <!-- Bouton pour ouvrir le tableau -->
    <button id="toggle-table-btn" class="toggle-table-btn" title="Voir le tableau des communes">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="3" y1="9" x2="21" y2="9"></line>
            <line x1="9" y1="21" x2="9" y2="9"></line>
        </svg>
    </button>

    <!-- Panneau tableau -->
    <div id="table-panel" class="table-panel hidden">
        <div class="table-panel-header">
            <h2 class="table-panel-title">Communes par temps d'accès</h2>
            <button id="close-table-btn" class="close-table-btn" aria-label="Fermer">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        
        <div class="table-panel-content">
            <!-- Filtres -->
            <div class="table-filters">
                <button class="filter-btn active" data-time="all">
                    Toutes <span class="filter-count" id="count-all">0</span>
                </button>
                <button class="filter-btn filter-10min" data-time="600">
                    10 min <span class="filter-count" id="count-600">0</span>
                </button>
                <button class="filter-btn filter-20min" data-time="1200">
                    20 min <span class="filter-count" id="count-1200">0</span>
                </button>
                <button class="filter-btn filter-30min" data-time="1800">
                    30 min <span class="filter-count" id="count-1800">0</span>
                </button>
            </div>

            <!-- Tableau -->
            <div class="table-wrapper">
                <table class="communes-table">
                    <thead>
                        <tr>
                            <th>Commune</th>
                            <th>Code INSEE</th>
                            <th>Temps d'accès</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Contenu généré dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

<!-- Bottom Sheet -->
<div id="bottom-sheet" class="bottom-sheet hidden">
    <div class="bottom-sheet-handle"></div>
    <div class="bottom-sheet-content">
        <h2 id="feature-name" class="feature-name"></h2>
        <div class="feature-details">
            <div class="detail-row accessibility-status">
                <span class="detail-label">Temps d'accès :</span>
                <span id="feature-time" class="detail-value status-time"></span>
            </div>
            
            <!-- Prix appartement avec min/max -->
            <div class="detail-row">
                <span class="detail-label">Prix appt./m² :</span>
                <div class="detail-value-group">
                    <span id="feature-prix-appt" class="detail-value detail-price"></span>
                    <span id="feature-minmax-appt" class="detail-minmax"></span>
                    <span id="feature-ventes-appt" class="detail-subtitle"></span>
                </div>
            </div>
            
            <!-- Prix maison avec min/max -->
            <div class="detail-row">
                <span class="detail-label">Prix maison/m² :</span>
                <div class="detail-value-group">
                    <span id="feature-prix-maison" class="detail-value detail-price"></span>
                    <span id="feature-minmax-maison" class="detail-minmax"></span>
                    <span id="feature-ventes-maison" class="detail-subtitle"></span>
                </div>
            </div>
        </div>
        <button id="close-sheet" class="close-button">Fermer</button>
    </div>
</div>

    <!-- Message d'erreur -->
    <div id="error-message" class="error-message hidden">
        <p id="error-text"></p>
    </div>

    <!-- Script principal -->
    <script src="app.js"></script>
</body>
</html>